# Reproducible Research: Peer Assessment 1

## Prerequisites
I am going to use ggplot2 for ploting and data.table for subsetting, so I have to load it first.  
Also set up locale to make work with weekdays consistent.
```{r}
library(ggplot2)
library(data.table)

Sys.setlocale("LC_TIME", "us")
```


## Loading and preprocessing the data
First we need to unzip and read data.
```{r}
unzip("activity.zip")
activity <- data.table(read.csv("activity.csv"))

```


## What is mean total number of steps taken per day?


We have alot of NA's in the data, so we have to ignore them during computations by applying option **na.rm=TRUE**.  

```{r}

setkey(activity, date)
stepByDay <- activity[,sum(steps, na.rm=TRUE), date]

setnames(stepByDay, "V1", "steps")

p <- ggplot(stepByDay, aes(x=steps))  + 
  geom_histogram(binwidth=1000, colour="black", fill="white") + 
  geom_vline(aes(xintercept = mean(steps)), colour="green", show_guide = T) +
  geom_vline(aes(xintercept = median(steps)), colour="red", show_guide = T) + 
  ggtitle("Mean and median total number of steps taken per day") +
  theme(legend.position="bottom") 
   
displayLegend <- c(paste0("Mean = ", round(mean(stepByDay$steps),2)), 
                   paste0("Median = ", median(stepByDay$steps)))

p + scale_colour_manual( values = c("red","green"), 
                       limits = displayLegend)

```



## What is the average daily activity pattern?

```{r}
setkey(activity, interval)
stepByInt <- activity[,mean(steps, na.rm=TRUE), interval]
setnames(stepByInt, "V1", "meanSteps")

ggplot(stepByInt, aes(x=interval, y=meanSteps)) +
  geom_line() +
  ggtitle("Average number of steps taken, averaged across all days")

```



## Imputing missing values
Total number of missing values in the dataset
```{r}
table(is.na(activity$steps))["TRUE"]
```

Make a copy of activity data to eliminate NAs and substitute NAs there.
```{r}
actImpute <- activity

actImpute[is.na(steps)]$steps <- as.integer(mean(activity$steps, na.rm=TRUE))

stepByDayImpute <- actImpute[,sum(steps), date]
setnames(stepByDayImpute, "V1", "steps")

displayLegend <- c(paste0("Mean = ", round(mean(stepByDayImpute$steps), 2)), 
                   paste0("Median = ", median(stepByDayImpute$steps)))

p %+% stepByDayImpute %+% ggtitle("Imputed Data. Mean and median total number of steps taken per day") +
  scale_colour_manual( values = c("green","green"), 
                       limits = displayLegend)

```
We can see that thouse days with only NAs values now contribute to the mean value of distribution.  
Therefore distribution mean and median values shifted and become closer to each other.

## Are there differences in activity patterns between weekdays and weekends?

```{r}
activity$wd <- as.factor(weekdays(strptime(activity$date, "%Y-%m-%d"), TRUE))
```

